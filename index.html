<script>
  async function handleSubmit(e) {
    e.preventDefault();

    const name = document.getElementById("name").value;
    const age = document.getElementById("age").value;
    const gender = document.querySelector('input[name="gender"]:checked').value;
    const phone = document.getElementById("phone").value;
    const city = document.getElementById("city").value;
    const car = document.querySelector('input[name="car"]:checked').value;
    const japanese = document.querySelector('input[name="japanese"]:checked').value;
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;

    const fullDatetime = new Date(`${date}T${time}`);
    const now = new Date();
    const diff = (fullDatetime - now) / (1000 * 60); // em minutos

    // 1. Buscar status do painel no JSONBin
    let disponivel = false;
    await fetch("https://api.jsonbin.io/v3/b/684277898561e97a5020346c", {
      headers: {
        "X-Master-Key": "$2a$10$fYX1tWsJ/Op2W7oSjb8FnOCRGVujCKYElfZxvXzQWBVLN1QkbXboi"
      }
    })
    .then(res => res.json())
    .then(data => {
      disponivel = data.record.disponivel;
    });

    // 2. Envia os dados para Google Sheets
    await fetch("https://script.google.com/macros/s/AKfycbxgEuqK-OjQCKwCShZBi8Gm0YJE1IwEcH_k451608eoAeSEA6sNpT3iw4I8VB7r86SC/exec", {
      method: "POST",
      body: new URLSearchParams({
        name, age, gender, phone, city, car, japanese, date, time
      })
    });

    // 3. Redirecionamento com base na disponibilidade
    if (diff <= 10) {
      if (disponivel) {
        window.location.href = "https://meet.google.com/sym-fhub-czn";
      } else {
        window.location.href = "aguarde.html";
      }
    } else {
      window.location.href = "confirmacao.html";
    }
  }
</script>
